#! /usr/bin/env python
# -*- coding: utf-8 -*-
# vim:fenc=utf-8
#
# Copyright Â© 2019 Cesar Sinchiguano <cesarsinchiguano@hotmail.es>
#
# Distributed under terms of the MIT license.

"""
Inspired by MoveIt tutorial
"""
#from ur10_class_01 import *

import sys
sys.path.insert(0, '/home/casch/ws_moveit/src/perception_cvut/src/project')
from ur10_class import *
import tf
import tf2_ros
from tf.transformations import *

moves_deg = np.array([ [-0.15765411058534795,  -1.5020406881915491,  1.7862472534179688,  -0.7866681257831019,  1.5294280052185059,  0.07009610533714294] ,
                        [-0.20360261598695928,  -1.5078142325030726,  1.7936277389526367,  -0.8225310484515589,  1.1550047397613525,  0.10038548707962036] ,
                        [-0.2403352896319788,  -1.5030587355243128,  1.7852630615234375,  -0.8793223539935511,  0.8117840886116028,  0.15076230466365814] ,
                        [-0.20834428468813115,  -1.518282715474264,  1.8132357597351074,  -0.8750045935260218,  0.8384175300598145,  0.12647177278995514] ,
                        [-0.1666324774371546,  -1.522247616444723,  1.8220319747924805,  -0.8256133238421839,  1.213396430015564,  0.07894683629274368] ,
                        [-0.15379888216127569,  -1.521325413380758,  1.8213958740234375,  -0.8167374769793909,  1.3170322179794312,  0.06990435719490051] ,
                        [-0.1140063444720667,  -1.5129287878619593,  1.8104639053344727,  -0.7958672682391565,  1.6282052993774414,  0.048526376485824585] ,
                        [-0.07089883485902959,  -1.494063679371969,  1.7819151878356934,  -0.7783797422992151,  1.9765706062316895,  0.030071042478084564] ,
                        [-0.08619767824281865,  -1.4688504377948206,  1.73360013961792,  -0.7521827856646937,  1.963155746459961,  0.03785591945052147] ,
                        [-0.06599074998964483,  -1.4551718870746058,  1.7111101150512695,  -0.7418554464923304,  2.1479761600494385,  0.03032233752310276] ,
                        [-0.059670273457662404,  -1.4588130156146448,  1.6892433166503906,  -0.7174943129168909,  2.1632208824157715,  0.02724463865160942] ,
                        [-0.08703548112978154,  -1.476863209401266,  1.7184786796569824,  -0.7303527037249964,  1.914421558380127,  0.03785591945052147] ,
                        [-0.14438897768129522,  -1.4815824667560022,  1.7207832336425781,  -0.7471936384784144,  1.4262478351593018,  0.06374859064817429] ,
                        [-0.16595060030092412,  -1.5915668646441858,  1.912409782409668,  -0.8307831923114222,  1.4073041677474976,  0.07457558810710907]])


#Monday-260-August good calibration about the realsense camera
# moves_deg = np.array([  [0.01858903095126152,  -1.9780901114093226,  1.8670544624328613,  -0.45019656816591436,  1.6612600088119507,  0.001257220166735351] ,
#                         [-0.14448482195009404,  -2.0233238379107874,  1.897087574005127,  -0.4330180327044886,  1.522818684577942,  0.0879054144024849] ,
#                         [-0.4205883185016077,  -2.0689666906939905,  1.931535243988037,  -0.44666988054384404,  1.2904313802719116,  0.23898304998874664] ,
#                         [-0.6483748594867151,  -2.0746586958514612,  1.9477806091308594,  -0.5083535353290003,  1.1031628847122192,  0.37853899598121643] ,
#                         [-0.5656216780291956,  -1.9454992453204554,  1.8057236671447754,  -0.47279674211610967,  1.170340895652771,  0.3252365291118622] ,
#                         [-0.5947659651385706,  -1.951897446309225,  1.818251609802246,  -0.5480836073504847,  1.000385046005249,  0.3728599548339844] ,
#                         [-0.3222234884845179,  -1.9726503531085413,  1.8280558586120605,  -0.45559484163393194,  1.2191922664642334,  0.19104428589344025] ,
#                         [-0.075782601033346,  -1.9457867781268519,  1.8145079612731934,  -0.4342301527606409,  1.4251078367233276,  0.05125690624117851] ,
#                         [0.13415928184986115,  -1.8944814840899866,  1.786487102508545,  -0.4512284437762659,  1.6031728982925415,  -0.060486618672506154] ,
#                         [0.13539215922355652,  -1.8836138884173792,  1.7579498291015625,  -0.3441985289203089,  1.609470248222351,  -0.058296028767721] ,
#                         [0.12829487025737762,  -1.8502228895770472,  1.8215994834899902,  -0.44077951112856084,  1.6032451391220093,  -0.05509835878481084] ,
#                         [-0.12571365038026983,  -1.9083316961871546,  1.8552589416503906,  -0.425544563923971,  1.3767586946487427,  0.06114950776100159] ,
#                         [-0.05867654481996709,  -2.009975258504049,  1.8976635932922363,  -0.4661758581744593,  1.5529152154922485,  -0.018646065388814748] ,
#                         [0.04326941817998886,  -1.971572224293844,  1.8736777305603027,  -0.5187414328204554,  2.0791914463043213,  -0.08514291444887334] ,
#                         [-0.22375280061830694,  -2.0229161421405237,  1.8877520561218262,  -0.5344803969012659,  0.6534196734428406,  0.11809967458248138] ,
#                         [-0.05612689653505498,  -2.009472195302145,  1.8974237442016602,  -0.46659547487367803,  1.5649821758270264,  -0.01996308961977178]])
 

def move(object_robot):
    import time
    global g_index_last_move
    global g_timestamp_last_move
    global poses
    global joints

    if (time.time() - g_timestamp_last_move) < 0.5:
        print('time: {}'.format((time.time() - g_timestamp_last_move)))
        return

    g_index_last_move = (g_index_last_move + 1) % len(poses)

    object_robot.go_to_joint_state(moves_deg[g_index_last_move])

    print('g_index_last_move {}'.format(g_index_last_move))

    g_timestamp_last_move = time.time()

def main():
    global home

    br = tf2_ros.TransformBroadcaster()
    r=rospy.Rate(10)

    # #Task space
    # ##########
    # print "============ Press `Enter` to go to --> Home position..."
    # raw_input()
    # object_ur10.go_to_pose_goal(home)
    # #time.sleep(3)
    print "============ Press `Enter` to start start sample poses..."
    raw_input()

    while(not rospy.is_shutdown()):
        try:
            move(object_ur10)
            pose_TCP=object_ur10.move_group.get_current_pose().pose
            print "============ Python movement in JointSpace is completed!"
            r.sleep()
        except rospy.ROSInterruptException:
            return
        except KeyboardInterrupt:
            return

if __name__ == '__main__':
    print ""
    print "----------------------------------------------------------"
    print "Welcome to the MoveIt MoveGroup Python Interface"
    print "----------------------------------------------------------"
    print "Press Ctrl-D to exit at any time"
    print ""
    print "============ Press `Enter` to begin the moveit_commander ..."
    raw_input()
    #create an object in order to get acces to my UniversalRobot
    object_ur10 = UniversalRobot()
    main()


# print(pose_TCP)
# print(pose_TCP.position)
# print(pose_TCP.position.x)
# print(type(pose_TCP.position))
# print(pose_TCP.orientation)
# print(pose_TCP.orientation.w)
# print(type(pose_TCP))



# t = geometry_msgs.msg.TransformStamped()
# t.header.stamp = rospy.Time.now()
# t.header.frame_id = 'tool0'
# t.child_frame_id = 'camera_link'
# t.transform.translation.x = 0.10
# t.transform.translation.y = 0.15
# t.transform.translation.z = 0.30
#
# q2 = tf.transformations.quaternion_from_euler(math.pi,0,0)
# t.transform.rotation.x = q2[0]
# t.transform.rotation.y = q2[1]
# t.transform.rotation.z = q2[2]
# t.transform.rotation.w = q2[3]
# br.sendTransform(t)






# #Sunday 26_August_2019
# moves_deg = np.array([  [-0.10323173204530889,  -0.8811543623553675,  0.5456719398498535,  0.5135899782180786,  1.6264780759811401,  0.01832275651395321] ,
#                         [-0.19529420534242803,  -0.926981274281637,  0.6245198249816895,  0.48033177852630615,  1.5355935096740723,  0.0020118518732488155] ,
#                         [-0.19566566148866826,  -0.9863651434527796,  0.8286871910095215,  0.3355388641357422,  1.5354856252670288,  0.0019758990965783596] ,
#                         [-0.19579679170717412,  -0.9506438414203089,  0.6994943618774414,  0.4287705421447754,  1.5352815389633179,  0.0018920095171779394] ,
#                         [-0.20140010515321904,  -1.1962350050555628,  1.0344691276550293,  0.3395572900772095,  1.5296317338943481,  0.0009456302504986525] ,
#                         [-0.07221538225282842,  -1.1510017553912562,  0.9685111045837402,  0.3606315851211548,  1.6568944454193115,  0.02377183362841606] ,
#                         [-0.3026817480670374,  -1.2141988913165491,  1.0605449676513672,  0.33263635635375977,  1.430134892463684,  -0.017101112996236623] ,
#                         [-0.3029211203204554,  -1.2502830664264124,  1.1302008628845215,  0.1525052785873413,  1.4286353588104248,  0.0035087564028799534] ,
#                         [0.0657113790512085,  -1.2069652716266077,  1.064183235168457,  0.1750565767288208,  1.797229290008545,  0.01536490023136139] ,
#                         [0.01492635253816843,  -1.1809890905963343,  0.8742337226867676,  0.33284008502960205,  1.3243273496627808,  0.013879605568945408] ,
#                         [0.10986388474702835,  -1.1784146467791956,  0.8677754402160645,  0.3362466096878052,  1.4192895889282227,  0.016298919916152954] ,
#                         [-0.09420568147768194,  -1.1645467917071741,  0.8539457321166992,  0.33763790130615234,  1.2150405645370483,  0.01063412707298994] ,
#                         [-0.17492944398988897,  -1.137158219014303,  0.8165020942687988,  0.34848105907440186,  1.1344964504241943,  0.008358997292816639] ,
#                         [-0.24304134050478154,  -1.1015666166888636,  0.765782356262207,  0.3646496534347534,  1.0662600994110107,  0.006047539878636599]])
