#! /usr/bin/env python
# -*- coding: utf-8 -*-
# vim:fenc=utf-8
#
# Copyright Â© 2019 Cesar Sinchiguano <cesarsinchiguano@hotmail.es>
#
# Distributed under terms of the MIT license.

"""
Inspired by MoveIt tutorial
"""
#from ur10_class_01 import *

import sys
sys.path.insert(0, '/home/casch/ws_moveit/src/perception_cvut/src/project')
from ur10_class import *
import tf
import tf2_ros
from tf.transformations import *


moves_deg = np.array([  [-0.12425309816469365,  -1.2278993765460413,  1.2741327285766602,  -0.1898883024798792,  1.3887799978256226,  0.06485038995742798] ,
                        [-0.13707477251161748,  -1.3154943625079554,  1.4019837379455566,  -0.23053199449648076,  1.3762785196304321,  0.06667086482048035] ,
                        [-0.1243370215045374,  -1.2282465139972132,  1.2743487358093262,  -0.18987638155092412,  1.388816237449646,  0.06473054736852646] ,
                        [-0.11605340639223272,  -1.1612532774554651,  1.1716675758361816,  -0.15376693407167608,  1.397106409072876,  0.0635448545217514] ,
                        [-0.16659671465028936,  -1.1604388395892542,  1.1737089157104492,  -0.15781051317323858,  1.346968173980713,  0.07088632136583328] ,
                        [-0.20472842851747686,  -1.1574333349811,  1.1712594032287598,  -0.16001731554140264,  1.3092451095581055,  0.07664735615253448] ,
                        [-0.22040063539613897,  -1.2397797743426722,  1.2972421646118164,  -0.20450002351869756,  1.2937548160552979,  0.07899477332830429] ,
                        [-0.22437554994692022,  -1.271336857472555,  1.3440494537353516,  -0.24035722414125615,  1.0588793754577637,  0.08758221566677094] ,
                        [-0.17097884813417608,  -1.2923195997821253,  1.3709397315979004,  -0.24166471162904912,  1.1116230487823486,  0.07765328884124756] ,
                        [-0.10586530367006475,  -1.311207119618551,  1.394744873046875,  -0.24165279070009404,  1.1756929159164429,  0.06606004387140274] ,
                        [-0.13804418245424444,  -1.404578987752096,  1.523775577545166,  -0.2799456755267542,  1.144012689590454,  0.07171285152435303] ,
                        [-0.09276944795717412,  -1.2430012861834925,  1.2756333351135254,  -0.054989163075582326,  1.1838411092758179,  0.013197253458201885] ,
                        [-0.05259591737856084,  -1.0776999632464808,  1.0366301536560059,  0.019266843795776367,  1.2241597175598145,  0.012095454148948193] ,
                        [-0.03346759477724248,  -0.9791443983661097,  0.9110774993896484,  0.0464017391204834,  1.2430349588394165,  0.01177225448191166] ,
                        [-0.02413064638246709,  -0.9186947981463831,  0.8122644424438477,  0.08495688438415527,  1.252706527709961,  0.01150860171765089] ,
                        [0.022778267040848732,  -0.931220833455221,  0.8323607444763184,  0.07759153842926025,  1.2995742559432983,  0.010430769994854927] ,
                        [0.02310146577656269,  -0.8967211882220667,  0.7576436996459961,  0.23565709590911865,  1.3005220890045166,  -0.02113658586610967] ,
                        [0.022586893290281296,  -0.9101327101336878,  0.8305597305297852,  0.17644822597503662,  1.2998981475830078,  -0.02113658586610967] ,
                        [-0.0011490027057092789,  -1.0640719572650355,  1.0628623962402344,  0.0988001823425293,  1.2761526107788086,  -0.02357942262758428]])

def move(object_robot):
    import time
    global g_index_last_move
    global g_timestamp_last_move
    global poses
    global joints

    if (time.time() - g_timestamp_last_move) < 8:
        print('time: {}'.format((time.time() - g_timestamp_last_move)))
        return

    g_index_last_move = (g_index_last_move + 1) % len(poses)

    object_robot.go_to_joint_state(moves_deg[g_index_last_move])

    print('g_index_last_move {}'.format(g_index_last_move))

    g_timestamp_last_move = time.time()

def main():
    global home

    br = tf2_ros.TransformBroadcaster()
    r=rospy.Rate(10)

    # print "============ Press `Enter` to start start sample poses..."
    # raw_input()

    while(not rospy.is_shutdown()):
        try:
            move(object_ur10)
            pose_TCP=object_ur10.move_group.get_current_pose().pose
            print "============ Python movement in JointSpace is completed!"
            r.sleep()
        except rospy.ROSInterruptException:
            return
        except KeyboardInterrupt:
            return

if __name__ == '__main__':
    # print ""
    # print "----------------------------------------------------------"
    # print "Welcome to the MoveIt MoveGroup Python Interface"
    # print "----------------------------------------------------------"
    # print "Press Ctrl-D to exit at any time"
    # print ""
    # print "============ Press `Enter` to begin the moveit_commander ..."
    # raw_input()
    #create an object in order to get acces to my UniversalRobot
    object_ur10 = UniversalRobot()
    main()

# #Sunday 26_August_2019
# moves_deg = np.array([  [-0.10323173204530889,  -0.8811543623553675,  0.5456719398498535,  0.5135899782180786,  1.6264780759811401,  0.01832275651395321] ,
#                         [-0.19529420534242803,  -0.926981274281637,  0.6245198249816895,  0.48033177852630615,  1.5355935096740723,  0.0020118518732488155] ,
#                         [-0.19566566148866826,  -0.9863651434527796,  0.8286871910095215,  0.3355388641357422,  1.5354856252670288,  0.0019758990965783596] ,
#                         [-0.19579679170717412,  -0.9506438414203089,  0.6994943618774414,  0.4287705421447754,  1.5352815389633179,  0.0018920095171779394] ,
#                         [-0.20140010515321904,  -1.1962350050555628,  1.0344691276550293,  0.3395572900772095,  1.5296317338943481,  0.0009456302504986525] ,
#                         [-0.07221538225282842,  -1.1510017553912562,  0.9685111045837402,  0.3606315851211548,  1.6568944454193115,  0.02377183362841606
#Monday-260-August good calibration about the realsense camera
# moves_deg = np.array([  [0.01858903095126152,  -1.9780901114093226,  1.8670544624328613,  -0.45019656816591436,  1.6612600088119507,  0.001257220166735351] ,
#                         [-0.14448482195009404,  -2.0233238379107874,  1.897087574005127,  -0.4330180327044886,  1.522818684577942,  0.0879054144024849] ,
#                         [-0.4205883185016077,  -2.0689666906939905,  1.931535243988037,  -0.44666988054384404,  1.2904313802719116,  0.23898304998874664] ,
#                         [-0.6483748594867151,  -2.0746586958514612,  1.9477806091308594,  -0.5083535353290003,  1.1031628847122192,  0.37853899598121643] ,
#                         [-0.5656216780291956,  -1.9454992453204554,  1.8057236671447754,  -0.47279674211610967,  1.170340895652771,  0.3252365291118622] ,
#                         [-0.5947659651385706,  -1.951897446309225,  1.818251609802246,  -0.5480836073504847,  1.000385046005249,  0.3728599548339844] ,
#                         [-0.3222234884845179,  -1.9726503531085413,  1.8280558586120605,  -0.45559484163393194,  1.2191922664642334,  0.19104428589344025] ,
#                         [-0.075782601033346,  -1.9457867781268519,  1.8145079612731934,  -0.4342301527606409,  1.4251078367233276,  0.05125690624117851] ,
#                         [0.13415928184986115,  -1.8944814840899866,  1.786487102508545,  -0.4512284437762659,  1.6031728982925415,  -0.060486618672506154] ,
#                         [0.13539215922355652,  -1.8836138884173792,  1.7579498291015625,  -0.3441985289203089,  1.609470248222351,  -0.058296028767721] ,
#                         [0.12829487025737762,  -1.8502228895770472,  1.8215994834899902,  -0.44077951112856084,  1.6032451391220093,  -0.05509835878481084] ,
#                         [-0.12571365038026983,  -1.9083316961871546,  1.8552589416503906,  -0.425544563923971,  1.3767586946487427,  0.06114950776100159] ,
#                         [-0.05867654481996709,  -2.009975258504049,  1.8976635932922363,  -0.4661758581744593,  1.5529152154922485,  -0.018646065388814748] ,
#                         [0.04326941817998886,  -1.971572224293844,  1.8736777305603027,  -0.5187414328204554,  2.0791914463043213,  -0.08514291444887334] ,
#                         [-0.22375280061830694,  -2.0229161421405237,  1.8877520561218262,  -0.5344803969012659,  0.6534196734428406,  0.11809967458248138] ,
#                         [-0.05612689653505498,  -2.009472195302145,  1.8974237442016602,  -0.46659547487367803,  1.5649821758270264,  -0.01996308961977178]])] ,
#                         [-0.3026817480670374,  -1.2141988913165491,  1.0605449676513672,  0.33263635635375977,  1.430134892463684,  -0.017101112996236623] ,
#                         [-0.3029211203204554,  -1.2502830664264124,  1.1302008628845215,  0.1525052785873413,  1.4286353588104248,  0.0035087564028799534] ,
#                         [0.0657113790512085,  -1.2069652716266077,  1.064183235168457,  0.1750565767288208,  1.797229290008545,  0.01536490023136139] ,
#                         [0.01492635253816843,  -1.1809890905963343,  0.8742337226867676,  0.33284008502960205,  1.3243273496627808,  0.013879605568945408] ,
#                         [0.10986388474702835,  -1.1784146467791956,  0.8677754402160645,  0.3362466096878052,  1.4192895889282227,  0.016298919916152954] ,
#                         [-0.09420568147768194,  -1.1645467917071741,  0.8539457321166992,  0.33763790130615234,  1.2150405645370483,  0.01063412707298994] ,
#                         [-0.17492944398988897,  -1.137158219014303,  0.8165020942687988,  0.34848105907440186,  1.1344964504241943,  0.008358997292816639] ,
#                         [-0.24304134050478154,  -1.1015666166888636,  0.765782356262207,  0.3646496534347534,  1.0662600994110107,  0.006047539878636599]])


#Monday-260-August good calibration about the realsense camera
# moves_deg = np.array([  [0.01858903095126152,  -1.9780901114093226,  1.8670544624328613,  -0.45019656816591436,  1.6612600088119507,  0.001257220166735351] ,
#                         [-0.14448482195009404,  -2.0233238379107874,  1.897087574005127,  -0.4330180327044886,  1.522818684577942,  0.0879054144024849] ,
#                         [-0.4205883185016077,  -2.0689666906939905,  1.931535243988037,  -0.44666988054384404,  1.2904313802719116,  0.23898304998874664] ,
#                         [-0.6483748594867151,  -2.0746586958514612,  1.9477806091308594,  -0.5083535353290003,  1.1031628847122192,  0.37853899598121643] ,
#                         [-0.5656216780291956,  -1.9454992453204554,  1.8057236671447754,  -0.47279674211610967,  1.170340895652771,  0.3252365291118622] ,
#                         [-0.5947659651385706,  -1.951897446309225,  1.818251609802246,  -0.5480836073504847,  1.000385046005249,  0.3728599548339844] ,
#                         [-0.3222234884845179,  -1.9726503531085413,  1.8280558586120605,  -0.45559484163393194,  1.2191922664642334,  0.19104428589344025] ,
#                         [-0.075782601033346,  -1.9457867781268519,  1.8145079612731934,  -0.4342301527606409,  1.4251078367233276,  0.05125690624117851] ,
#                         [0.13415928184986115,  -1.8944814840899866,  1.786487102508545,  -0.4512284437762659,  1.6031728982925415,  -0.060486618672506154] ,
#                         [0.13539215922355652,  -1.8836138884173792,  1.7579498291015625,  -0.3441985289203089,  1.609470248222351,  -0.058296028767721] ,
#                         [0.12829487025737762,  -1.8502228895770472,  1.8215994834899902,  -0.44077951112856084,  1.6032451391220093,  -0.05509835878481084] ,
#                         [-0.12571365038026983,  -1.9083316961871546,  1.8552589416503906,  -0.425544563923971,  1.3767586946487427,  0.06114950776100159] ,
#                         [-0.05867654481996709,  -2.009975258504049,  1.8976635932922363,  -0.4661758581744593,  1.5529152154922485,  -0.018646065388814748] ,
#                         [0.04326941817998886,  -1.971572224293844,  1.8736777305603027,  -0.5187414328204554,  2.0791914463043213,  -0.08514291444887334] ,
#                         [-0.22375280061830694,  -2.0229161421405237,  1.8877520561218262,  -0.5344803969012659,  0.6534196734428406,  0.11809967458248138] ,
#                         [-0.05612689653505498,  -2.009472195302145,  1.8974237442016602,  -0.46659547487367803,  1.5649821758270264,  -0.01996308961977178]])
